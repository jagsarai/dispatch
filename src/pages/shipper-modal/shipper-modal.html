<ion-header>
    
  <ion-navbar color="primary">
    <ion-title>Add Shipper</ion-title>
    <ion-buttons end>
      <button ion-button (click)="closeShipperModal()">Close</button>
    </ion-buttons>
  </ion-navbar>

</ion-header>
    
    
<ion-content padding>

  <ion-buttons *ngIf="createToggle; else showAltAddButton">
      <button ion-button  (click)="createToggle = !createToggle" class="driver-toggle-button">
        <div>
          <ion-icon name="build"></ion-icon>
          Create New Shipper
        </div>
      </button>
  </ion-buttons>
  <ng-template #showAltAddButton>
      <button ion-button  (click)="createToggle = !createToggle" class="driver-toggle-button">
          <div>
            <ion-icon name="add-circle"></ion-icon>
            Add Existing Shipper
          </div>
      </button>
  </ng-template>
  
  <div *ngIf="createToggle; else showForm">
    <ion-searchbar [(ngModel)]="searchTerm" [formControl]="searchControl" (ionInput)="onSearchInput()"></ion-searchbar>

    <div *ngIf="searching" class="spinner-container">
        <ion-spinner name="bubbles"></ion-spinner>
    </div>

    <ion-list no-lines>
      <ion-card *ngFor="let shipper of shippers">
        <ion-card-content>
          <ion-item >
            <div (click)="addExistingShipper(shipper)">
                  {{shipper.name}} 
                  <br>
                  {{shipper.address}}
                  <br>
                  {{shipper.city}},  {{shipper.state}} {{shipper.zipCode}}
            </div>
          </ion-item>
        </ion-card-content>
      </ion-card>
      
    </ion-list>
  </div>

  <ng-template #showForm>
    <div>
      <form #f="ngForm" novalidate (ngSubmit)="addNewShipper()">
        <ion-card>
          <ion-card-content>

              <ion-item>
                  <ion-label floating>Name</ion-label>
                  <ion-input type="text" [formControl]="shipperNameConfirmControl" [(ngModel)]="shipperName" required minLength="5"></ion-input>
              </ion-item>
    
              <div padding *ngIf="shipperNameConfirmControl.invalid && (shipperNameConfirmControl.dirty || shipperNameConfirmControl.touched)">
                  <span class="global__input-error">Name is required (minimum of 5 characters).</span>
              </div>

              <div padding *ngIf="shipperNameMatch">
                  <span class="global__input-error">That name is already assigned to another shipper, please correct it.</span>
              </div>


              <ion-item>
                  <ion-label floating>Address</ion-label>
                  <ion-input type="text" [formControl]="shipperAddressConfirmControl" [(ngModel)]="shipperAddress" required pattern=""></ion-input>
              </ion-item>
  
              <div padding *ngIf="shipperAddressConfirmControl.invalid && (shipperAddressConfirmControl.dirty || shipperAddressConfirmControl.touched)">
                  <span class="global__input-error">Please provide a proper fromat with building number first and street name second</span>
              </div>

              <div padding *ngIf="shipperAddressMatch">
                  <span class="global__input-error">That address is already assigned to another shipper</span>
              </div>

              <ion-item>
                  <ion-label floating>City</ion-label>
                  <ion-input type="text" name="city" [(ngModel)]="shipperCity" required #city="ngModel"></ion-input>
              </ion-item>
  
              <div padding *ngIf="city.invalid && (city.dirty || city.touched)">
                  <span class="global__input-error">City is required</span>
              </div>
  
              <!-- <div padding *ngIf="driverEmailMatch">
                  <span class="global__input-error">This email is already taken</span>
              </div> -->

            <ion-item>
                <ion-label floating>State</ion-label>
                <ion-input type="text" name="state" [(ngModel)]="shipperState" required #state="ngModel" maxLength ="2"pattern="[A-Z][A-Z]"></ion-input>
            </ion-item>

            <div padding *ngIf="state.invalid && (state.dirty || state.touched)">
                <span class="global__input-error">State must be in this format CA</span>
            </div>

            <ion-item>
                <ion-label floating>Zip</ion-label>
                <ion-input type="text" name="zip" [(ngModel)]="shipperZipCode" required #zip="ngModel" minLength="5" maxLength="5" pattern="[0-9][0-9][0-9][0-9][0-9]"></ion-input>
            </ion-item>

            <div padding *ngIf="zip.invalid && (zip.dirty || zip.touched)">
                <span class="global__input-error">Zip Code should be 5 digits</span>
            </div>

            <button ion-button color="secondary" type="submit" [disabled]="f.invalid || shipperAddressMatch || shipperNameMatch" class="global__modal-add-button">Add</button>
          </ion-card-content>
        </ion-card>
      </form>
    </div>
  </ng-template>

</ion-content>
    
    
